{"version":3,"sources":["webpack:///src/base/singerList/singerList.vue","webpack:///./src/base/singerList/singerList.vue?6cb0","webpack:///./src/base/singerList/singerList.vue","webpack:///src/components/singer/singer.vue","webpack:///./src/components/singer/singer.vue?f948","webpack:///./src/components/singer/singer.vue","webpack:///./src/common/js/dom.js"],"names":["singerList","Array","Boolean","pos","pageY","targetIndex","refresh","y","item","index","listGroup","height","i","clientHeight","_this","this","_calculateHeight","listHeight","newY","fixTop","Scroll","scroll_scroll","Loading","loading","singerList_singerList","render","_vm","_h","$createElement","_c","_self","ref","staticClass","attrs","pullup","pulldown","data","listenScroll","probeType","on","scrollToEnd","loadMore","scroll","_l","group","key","refInFor","_v","_s","title","click","$event","selectItem","directives","name","rawName","value","expression","alt","touchstart","stopPropagation","preventDefault","onShortcutTouchStart","touchmove","onShortcutTouchMove","class","active","currentIndex","data-index","fixedTitle","length","_e","staticRenderFns","base_singerList_singerList","__webpack_require__","normalizeComponent","ssrContext","singer_singer","_getSingerList","methods","extends_default","bottom","id","singer","list","_this2","page","_this3","Fsinger_mid","Fsinger_name","Findex","ret","SingerList","components_singer_singer","singerListData","_gotoPrevPage","_loadMoreSinger","select","selectSinger","singer_Component","singer_normalizeComponent","__webpack_exports__","el","className","RegExp","test","hasClass","newClass","split","push","join","setAttribute","getAttribute"],"mappings":"wMA2DAA,uCAIA,WACA,QACA,UAEA,sBAIAC,gCAIAC,iBAGA,wDAIA,oCAEA,8FAMA,kDAKA,mEAEA,4DAKAC,mCAGA,yEAMA,qBACA,mBACAC,6BACAC,iBACAA,oDAGA,mBACAD,mDA9DA,GA+DA,uBACAC,4BACAA,2CAGAC,6CAGAC,8CAGAC,6CAOA,wDAEA,iCAEAC,+DACA,qEAIAC,YACA,uBACAC,8BACA,MACAC,GACAC,kCACAF,6BAKA,IAAAG,EAAAC,6BAEAC,oBACA,oCAGAC,oCAGA,oCAIA,SACAL,SACA,kBAIA,yBAFAA,mBACAM,8BAKA,kCA3HA,QA8HA,gCAIAC,qDACAA,EAAA,uBAIAC,OAAAC,EAAA,EAEAC,QAAAC,EAAA,IChMAC,GADiBC,OAFjB,WAA0B,IAAAC,EAAAX,KAAaY,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,UAAoBE,IAAA,WAAAC,YAAA,YAAAC,OAA8CC,QAAA,EAAAC,UAAA,EAAAC,KAAAV,EAAAU,KAAAC,aAAAX,EAAAW,aAAAC,UAAAZ,EAAAY,WAAwGC,IAAKJ,SAAAT,EAAAS,SAAAK,YAAAd,EAAAe,SAAAC,OAAAhB,EAAAgB,UAAwEb,EAAA,MAAWG,YAAA,0BAAqCN,EAAAiB,GAAAjB,EAAA,cAAAkB,EAAAnC,GAAyC,OAAAoB,EAAA,MAAgBgB,IAAApC,EAAAsB,IAAA,YAAAe,UAAA,EAAAd,YAAA,sBAAwEH,EAAA,MAAWG,YAAA,iBAA2BN,EAAAqB,GAAArB,EAAAsB,GAAAJ,EAAAK,UAAAvB,EAAAqB,GAAA,KAAAlB,EAAA,MAAqDG,YAAA,eAA0BN,EAAAiB,GAAAC,EAAA,eAAApC,EAAAC,GAA2C,OAAAoB,EAAA,MAAgBgB,IAAApC,EAAA8B,IAAcW,MAAA,SAAAC,GAAyBzB,EAAA0B,WAAA5C,OAAuBqB,EAAA,OAAYG,YAAA,mBAA6BH,EAAA,OAAYwB,aAAaC,KAAA,OAAAC,QAAA,SAAAC,MAAAhD,EAAA,OAAAiD,WAAA,gBAA0ExB,OAASyB,IAAA,QAAUhC,EAAAqB,GAAA,KAAAlB,EAAA,OAA0BG,YAAA,gBAA0BH,EAAA,QAAAH,EAAAqB,GAAArB,EAAAsB,GAAAxC,EAAA8C,qBAAkD5B,EAAAqB,GAAA,KAAAlB,EAAA,OAAyBG,YAAA,aAAAO,IAA6BoB,WAAA,SAAAR,GAA8BA,EAAAS,kBAAyBT,EAAAU,iBAAwBnC,EAAAoC,qBAAAX,IAAiCY,UAAA,SAAAZ,GAA8BA,EAAAS,kBAAyBT,EAAAU,iBAAwBnC,EAAAsC,oBAAAb,OAAkCtB,EAAA,KAAAH,EAAAiB,GAAAjB,EAAA,sBAAAlB,EAAAC,GAAyD,OAAAoB,EAAA,MAAgBgB,IAAApC,EAAAwD,OAAiBC,OAAAxC,EAAAyC,eAAA1D,GAAmCwB,OAAQmC,aAAA3D,KAAoBiB,EAAAqB,GAAA,qBAAArB,EAAAsB,GAAAxC,GAAA,yBAA+DkB,EAAAqB,GAAA,KAAAlB,EAAA,OAA2BwB,aAAaC,KAAA,OAAAC,QAAA,SAAAC,MAAA9B,EAAA,WAAA+B,WAAA,eAA4E1B,IAAA,QAAAC,YAAA,eAAuCH,EAAA,OAAYG,YAAA,gBAA0BN,EAAAqB,GAAArB,EAAAsB,GAAAtB,EAAA2C,YAAA,SAAA3C,EAAAqB,GAAA,KAAArB,EAAAU,KAAAkC,OAAmH5C,EAAA6C,KAAnH1C,EAAA,OAAkFG,YAAA,uBAAiCH,EAAA,kBAEtwD2C,oBCwBjBC,EAvBAC,EAAA,OAcAC,CACA3E,EACAwB,GATA,EAVA,SAAAoD,GACAF,EAAA,SAaA,kBAEA,MAUA,oBCHAG,qBAEA,qDAKA,OAGA,4BAIAC,kBAEAC,QAAAC,wDAEA,kCACAC,wBACA3E,yEAKA4E,oBACAC,8BAEA,IAAArE,EAAAC,eACA,gBACA,wBAhCA,kFAoCAqE,wBACAhD,sCAKA,IAAAiD,EAAAtE,2BAKAuE,6BA/CA,kFAoDAF,wBACAhD,0BATA,qCAcA,IAAAmD,EAAAxE,+CAEA,sBAGAuE,6BA/DA,kFAoEAF,wBACAhD,6FAOA,qDA/EA,4CACA,mCA4FAoD,mBAEAC,wBAGAC,0BAGA7C,2CAKA2C,mBAEAC,+CAKA,SACA5C,mCAGAW,GArHA,yBAuHAA,+EAKA,cAEAmC,4BAMA,4BAGAC,WAAAnB,ICtJAoB,GADiBpE,OAFjB,WAA0B,IAAaE,EAAbZ,KAAaa,eAA0BC,EAAvCd,KAAuCe,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,IAAA,SAAAC,YAAA,mBAA0CH,EAAA,eAAoBE,IAAA,aAAAE,OAAwBG,KAAtKrB,KAAsK+E,gBAA0BvD,IAAKJ,SAArMpB,KAAqMgF,cAAAvD,YAArMzB,KAAqMiF,gBAAAC,OAArMlF,KAAqMmF,gBAArMnF,KAA+RgC,GAAA,KAAAlB,EAAA,oBAExS2C,oBCejB2B,EAdAzB,EAAA,OAcA0B,CACAvB,EACAgB,GATA,EAVA,SAAAjB,GACAF,EAAA,SAaA,kBAEA,MAUA2B,EAAA,QAAAF,EAAA,iDCzBO,SAAkBG,EAAIC,GACzB,IASJ,SAAkBD,EAAIC,GAElB,OADU,IAAIC,OAAO,UAAYD,EAAY,WAClCE,KAAKH,EAAGC,WAXfG,CAASJ,EAAIC,GAAjB,CAGA,IAAII,EAAWL,EAAGC,UAAUK,MAAM,KAClCD,EAASE,KAAKN,GACdD,EAAGC,UAAYI,EAASG,KAAK,OAPjCT,EAAA,EAgBO,SAA0BC,EAAIhD,EAAME,GAGvC,OADAF,EADe,QACCA,EACZE,EACO8C,EAAGS,aAAazD,EAAME,GAEtB8C,EAAGU,aAAa1D","file":"static/js/2.03b94c2ae3e3c43a5670.js","sourcesContent":["<!-- 歌手列表组件 -->\r\n<template>\r\n    <scroll \r\n        class=\"list-view\" \r\n        :pullup=\"true\"\r\n        :pulldown=\"true\"\r\n        @pulldown=\"pulldown\"\r\n        @scrollToEnd=\"loadMore\"\r\n        :data=\"data\"\r\n        ref=\"listView\"\r\n        :listenScroll=\"listenScroll\"\r\n        :probeType=\"probeType\"\r\n        @scroll=\"scroll\">\r\n        <ul class=\"singer-containers-list\">\r\n            <li class=\"singer-items-sort\" v-for=\"(group, index) in data\" :key=\"index\" ref=\"listGroup\">\r\n                <h2 class=\"singer-title\">{{group.title}}</h2>\r\n                <ul class=\"singer-item\">\r\n                    <li @click=\"selectItem(item)\" v-for=\"(item, index) in group.items\" :key=\"index\">\r\n                        <div class=\"avatar-wrapper\">\r\n                            <img v-lazy=\"item.avatar\" alt=\"\">\r\n                        </div>\r\n                        <div class=\"singer-info\">\r\n                            <span>{{item.name}}</span>\r\n                        </div>\r\n                    </li>\r\n                </ul>\r\n            </li>\r\n        </ul>\r\n        <div \r\n            class=\"sort-entry\" \r\n            @touchstart.stop.prevent=\"onShortcutTouchStart\"\r\n            @touchmove.stop.prevent=\"onShortcutTouchMove\">\r\n            <ul>\r\n                <li \r\n                    v-for=\"(item, index) in shortCutList\" \r\n                    :key=\"index\" \r\n                    :data-index=\"index\"\r\n                    :class=\"{active: currentIndex === index}\">\r\n                    {{item}}\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class=\"list-fixed\" ref=\"fixed\" v-show=\"fixedTitle\">\r\n            <div class=\"fixed-title\">{{fixedTitle}} </div>\r\n        </div>\r\n        <div class=\"loading-containers\" v-if=\"!data.length\">\r\n            <Loading></Loading>\r\n        </div>\r\n    </scroll>\r\n</template>\r\n\r\n<script type='text/ecmascript-6'>\r\n    import Scroll from 'base/scroll/scroll'\r\n    import {getAttributeData} from 'common/js/dom'\r\n    import Loading from 'base/loading/loading'\r\n\r\n    // 18是右侧每个li的高度\r\n    const BASE_HEIGHT = 16\r\n    const TITLE_HEIGHT = 30\r\n    export default {\r\n        data () {\r\n            return {\r\n                currentIndex: 0,\r\n                scrollY: -1,\r\n                diff: -1,\r\n                pullup: true\r\n            }\r\n        },\r\n        props: {\r\n            data: {\r\n                type: Array,\r\n                default: []\r\n            },\r\n            hasMore: {\r\n                type: Boolean,\r\n                default: false\r\n            }\r\n        },\r\n        created () {\r\n            // 维护一个this.touch方便函数之间调用公共值\r\n            this.touch = {}\r\n            this.listenScroll = true\r\n            this.listHeight = []\r\n            this.probeType = 3\r\n        },\r\n        computed: {\r\n            // 计算属性\r\n            shortCutList () {\r\n                return this.data.map((group) => {\r\n                    return group.title.substr(0, 1)\r\n                })\r\n            },\r\n            fixedTitle () {\r\n                if (this.scrollY > 0) {\r\n                    return ''\r\n                }\r\n                return this.data[this.currentIndex] ? this.data[this.currentIndex].title : ''\r\n            }\r\n        },\r\n        methods: {\r\n            loadMore (pos) {\r\n                this.$emit('scrollToEnd', pos)\r\n            },\r\n            pulldown () {\r\n                this.$emit('pulldown')\r\n            },\r\n            onShortcutTouchStart (e) {\r\n                // e.target 为当前dom元素\r\n                // console.log(e.target.getAttribute('data-index'))\r\n                // better-scroll scrollToElement 滚动到锚点位置\r\n                let targetIndex = getAttributeData(e.target, 'index')\r\n                let firstTouch = e.touches[0]\r\n                this.touch.y1 = firstTouch.pageY\r\n                this.touch.targetIndex = targetIndex\r\n                this._scrollTo(targetIndex)\r\n            },\r\n            onShortcutTouchMove (e) {\r\n                let firstTouch = e.touches[0]\r\n                this.touch.y2 = firstTouch.pageY\r\n                let delTa = parseInt(this.touch.y2 - this.touch.y1) / BASE_HEIGHT | 0\r\n                let targetIndex = delTa + parseInt(this.touch.targetIndex)\r\n                this._scrollTo(targetIndex)\r\n            },\r\n            refresh () {\r\n                this.$refs.listView.refresh()\r\n            },\r\n            scroll (pos) {\r\n                this.scrollY = pos.y\r\n            },\r\n            selectItem (item) {\r\n                this.$emit('select', item)\r\n            },\r\n            _scrollTo (index) {\r\n                if (!index && index !== 0) {\r\n                    return\r\n                }\r\n                if (index < 0) {\r\n                    index = 0\r\n                } else if (index > this.listHeight.length - 2) {\r\n                    index = this.listHeight.length - 2\r\n                }\r\n                this.scrollY = -this.listHeight[index]\r\n                this.$refs.listView.scrollToElement(this.$refs.listGroup[index], 0)\r\n            },\r\n            _calculateHeight () {\r\n                this.listHeight = []\r\n                const list = this.$refs.listGroup\r\n                let height = 0\r\n                this.listHeight.push(height)\r\n                for (let i = 0; i < list.length; i++) {\r\n                    let item = list[i]\r\n                    height += item.clientHeight\r\n                    this.listHeight.push(height)\r\n                }\r\n            }\r\n        },\r\n        watch: {\r\n            data () {\r\n                setTimeout(() => {\r\n                    this._calculateHeight()\r\n                }, 20)\r\n            },\r\n            scrollY (newY) {\r\n                const listHeight = this.listHeight\r\n                // 滚动到顶部\r\n                if (newY > 0) {\r\n                    this.currentIndex = 0\r\n                    return\r\n                }\r\n                // 在中间滚动\r\n                for (let i = 0; i < listHeight.length - 1; i++) {\r\n                    let height1 = listHeight[i]\r\n                    let height2 = listHeight[i + 1]\r\n                    if (-newY >= height1 && -newY < height2) {\r\n                        this.currentIndex = i\r\n                        this.diff = height2 + newY\r\n                        return\r\n                    }\r\n                }\r\n                // 当滚动到底部，且-newY大于最后一个元素的上限\r\n                this.currentIndex = listHeight.length - 2\r\n            },\r\n            diff (newVal) {\r\n                let fixTop = (newVal > 0 && newVal < TITLE_HEIGHT) ? newVal - TITLE_HEIGHT : 0\r\n                if (this.fixTop === fixTop) {\r\n                    return\r\n                }\r\n                this.fixTop = fixTop\r\n                this.$refs.fixed.style.transform = `translate3d(0, ${fixTop}px, 0`\r\n            }\r\n        },\r\n        components: {\r\n            Scroll,\r\n            Loading\r\n        }\r\n    }\r\n</script>\r\n\r\n<style lang='less' scoped>\r\n    .list-view {\r\n        position: relative;\r\n        background: #222;\r\n        width: 100%;\r\n        overflow: hidden;\r\n        height: 100%;\r\n        .singer-containers-list {\r\n            .singer-items-sort {\r\n                .singer-title {\r\n                    background: #333;\r\n                    color: rgba(255,255,255,0.5);\r\n                    line-height: 3rem;\r\n                    box-sizing: border-box;\r\n                    padding: 0 2rem;\r\n                    font-size: 1.2rem;\r\n                }\r\n                .singer-item {\r\n                    padding-top: 2rem;\r\n                    li {\r\n                        display: flex;\r\n                        padding: 0 2rem 2rem 2rem;\r\n                        box-sizing: border-box;\r\n                        align-items: center;\r\n                        .avatar-wrapper {\r\n                            padding-right: 2rem;\r\n                            img {\r\n                                width: 5rem;\r\n                                height: 5rem;\r\n                                border-radius: 50%;\r\n                            }\r\n                        }\r\n                        .singer-info {\r\n                            font-size: 1.4rem;\r\n                            color: rgb(255,255,255);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        .sort-entry {\r\n            z-index: 4;\r\n            position: absolute;\r\n            right: 0rem;\r\n            top: 50%;\r\n            transform: translateY(-50%);\r\n            background: rgba(0,0,0,0.3);\r\n            border-radius: 1rem;\r\n            padding: 1.4rem 0;\r\n            li {\r\n                text-align: center;\r\n                color: rgba(255,255,255,0.5);\r\n                font-size: 1.2rem;\r\n                padding: .2rem;\r\n                line-height: 1;\r\n                &.active {\r\n                    color: #f90;\r\n                }\r\n            }\r\n        }\r\n        .list-fixed {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            .fixed-title {\r\n                height: 3rem;\r\n                line-height: 3rem;\r\n                padding: 0 2rem;\r\n                font-size: 1.2rem;\r\n                color: rgba(255,255,255,0.5);\r\n                background: #333;\r\n            }\r\n        }\r\n        .loading-containers{\r\n            position: absolute;\r\n            width: 100%;\r\n            top: 50%;\r\n            transform: translateY(-50%);\r\n        }\r\n    }\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/base/singerList/singerList.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('scroll',{ref:\"listView\",staticClass:\"list-view\",attrs:{\"pullup\":true,\"pulldown\":true,\"data\":_vm.data,\"listenScroll\":_vm.listenScroll,\"probeType\":_vm.probeType},on:{\"pulldown\":_vm.pulldown,\"scrollToEnd\":_vm.loadMore,\"scroll\":_vm.scroll}},[_c('ul',{staticClass:\"singer-containers-list\"},_vm._l((_vm.data),function(group,index){return _c('li',{key:index,ref:\"listGroup\",refInFor:true,staticClass:\"singer-items-sort\"},[_c('h2',{staticClass:\"singer-title\"},[_vm._v(_vm._s(group.title))]),_vm._v(\" \"),_c('ul',{staticClass:\"singer-item\"},_vm._l((group.items),function(item,index){return _c('li',{key:index,on:{\"click\":function($event){_vm.selectItem(item)}}},[_c('div',{staticClass:\"avatar-wrapper\"},[_c('img',{directives:[{name:\"lazy\",rawName:\"v-lazy\",value:(item.avatar),expression:\"item.avatar\"}],attrs:{\"alt\":\"\"}})]),_vm._v(\" \"),_c('div',{staticClass:\"singer-info\"},[_c('span',[_vm._v(_vm._s(item.name))])])])}))])})),_vm._v(\" \"),_c('div',{staticClass:\"sort-entry\",on:{\"touchstart\":function($event){$event.stopPropagation();$event.preventDefault();_vm.onShortcutTouchStart($event)},\"touchmove\":function($event){$event.stopPropagation();$event.preventDefault();_vm.onShortcutTouchMove($event)}}},[_c('ul',_vm._l((_vm.shortCutList),function(item,index){return _c('li',{key:index,class:{active: _vm.currentIndex === index},attrs:{\"data-index\":index}},[_vm._v(\"\\n                \"+_vm._s(item)+\"\\n            \")])}))]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.fixedTitle),expression:\"fixedTitle\"}],ref:\"fixed\",staticClass:\"list-fixed\"},[_c('div',{staticClass:\"fixed-title\"},[_vm._v(_vm._s(_vm.fixedTitle)+\" \")])]),_vm._v(\" \"),(!_vm.data.length)?_c('div',{staticClass:\"loading-containers\"},[_c('Loading')],1):_vm._e()])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-45de9697\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/base/singerList/singerList.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-45de9697\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./singerList.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./singerList.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./singerList.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-45de9697\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./singerList.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-45de9697\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/base/singerList/singerList.vue\n// module id = null\n// module chunks = ","<!-- 歌手组件 -->\r\n<template>\r\n    <div class=\"singer-wrapper\" ref=\"singer\">\r\n        <!-- 通过props把歌手数据列表传给子组件 -->\r\n        <singer-list @pulldown=\"_gotoPrevPage\" @scrollToEnd=\"_loadMoreSinger\" @select=\"selectSinger\" :data=\"singerListData\" ref=\"singerList\"></singer-list>\r\n        <router-view></router-view>\r\n    </div>\r\n</template>\r\n\r\n<script type='text/ecmascript-6'>\r\n    import {getSingerList} from 'api/singer'\r\n    import {ERR_OK} from 'api/config'\r\n    import Singer from 'common/js/singer'\r\n    import SingerList from 'base/singerList/singerList'\r\n    import {mapMutations} from 'vuex'\r\n    import {playListMixin} from 'common/js/mixin'\r\n\r\n    // 约定热门歌手为返回接口数据的默认排序的前十条数据\r\n    const HOT_NAME = '热门歌手'\r\n    const HOT_SINGER_LEN = 10\r\n    // 每页展示100条歌手数据\r\n    const pagesize = 100\r\n\r\n    export default {\r\n        mixins: [playListMixin],\r\n        data () {\r\n            return {\r\n                singerListData: [],\r\n                // 做下拉分页请求的标志位，为true时可加载下一页\r\n                hasMore: true,\r\n                // 维护page值，下拉时page++,向后台发送新请求，获得新数据\r\n                page: 1\r\n            }\r\n        },\r\n        created () {\r\n            // 把方法都定义在methods对象中，然后在这里调用相关方法，养成良好编码习惯\r\n            this._getSingerList()\r\n        },\r\n        methods: {\r\n            handlePlayList (playList) {\r\n                const bottom = playList.length > 0 ? '60px' : ''\r\n                this.$refs.singer.style.bottom = bottom\r\n                this.$refs.singerList.refresh()\r\n            },\r\n            selectSinger (singer) {\r\n                this.$router.push({\r\n                    path: `/singer/${singer.id}`\r\n                })\r\n                this.setSinger(singer)\r\n            },\r\n            _getSingerList () {\r\n                this.page = 1\r\n                this.hasMore = true\r\n                const result = getSingerList(this.page, pagesize)\r\n                result.then((res) => {\r\n                    if (res.code === ERR_OK) {\r\n                        this.singerListData = this._mapSingerListData(res.data.list)\r\n                        this._checkHasMore(res.data)\r\n                    }\r\n                })\r\n            },\r\n            // 下拉加载更多，分页请求\r\n            _loadMoreSinger (pos) {\r\n                if (!this.hasMore) {\r\n                    console.log('没有更多数据了')\r\n                    return\r\n                }\r\n                this.page++\r\n                const result = getSingerList(this.page, pagesize)\r\n                result.then((res) => {\r\n                    if (res.code === ERR_OK) {\r\n                        // 这里不把数据做拼接，而是覆盖掉之前的数据，实现当前页刷新数据\r\n                        this.singerListData = this._mapSingerListData(res.data.list)\r\n                        this._checkHasMore(res.data)\r\n                    }\r\n                })\r\n            },\r\n            // 下拉返回上一页数据\r\n            _gotoPrevPage () {\r\n                if (!this.hasMore || this.page < 2) {\r\n                    console.log('这是已经第一页了')\r\n                    return\r\n                }\r\n                this.page--\r\n                const result = getSingerList(this.page, pagesize)\r\n                result.then((res) => {\r\n                    if (res.code === ERR_OK) {\r\n                        // 这里不把数据做拼接，而是覆盖掉之前的数据，实现当前页刷新数据\r\n                        this.singerListData = this._mapSingerListData(res.data.list)\r\n                        this._checkHasMore(res.data)\r\n                    }\r\n                })\r\n            },\r\n            // check hasMore何时置为false，当满足以下if条件时，hasMore置为false\r\n            _checkHasMore (list) {\r\n                if (list.per_page + this.page * list.per_page > list.total) {\r\n                    this.hasMore = false\r\n                }\r\n            },\r\n            _mapSingerListData (listData) {\r\n                // 把源数据进行规则排序，约定数据前10条为热门歌手，其他剩余按字母升序排序\r\n                let obj = {\r\n                    hot: {\r\n                        title: HOT_NAME,\r\n                        items: []\r\n                    }\r\n                }\r\n                listData.forEach((item, index) => {\r\n                    if (index < HOT_SINGER_LEN) {\r\n                        obj.hot.items.push(new Singer({\r\n                            id: item.Fsinger_mid,\r\n                            name: item.Fsinger_name\r\n                        }))\r\n                    }\r\n                    // 把key值设置为返回数据的 item.Findex值，然后初始化key值为item.Findex值，items为空数组\r\n                    const key = item.Findex\r\n                    if (!obj[key]) {\r\n                        obj[key] = {\r\n                            title: key,\r\n                            items: []\r\n                        }\r\n                    }\r\n                    obj[key].items.push(new Singer({\r\n                        id: item.Fsinger_mid,\r\n                        name: item.Fsinger_name\r\n                    }))\r\n                })\r\n                // 得到有序列表，热门数据排在前面，其他按字母升序排序\r\n                let hot = []\r\n                let ret = []\r\n                for (let key in obj) {\r\n                    let value = obj[key]\r\n                    // value.title.match(/[a-zA-Z]/)\r\n                    if (/[a-zA-Z]/.test(value.title)) {\r\n                        ret.push(value)\r\n                    } else if (value.title === HOT_NAME) {\r\n                        hot.push(value)\r\n                    }\r\n                }\r\n                // 按字母升序排序\r\n                ret.sort((a, b) => {\r\n                    return a.title.charCodeAt(0) - b.title.charCodeAt(0)\r\n                })\r\n                return hot.concat(ret)\r\n            },\r\n            // mapMutatios提交修改歌手\r\n            ...mapMutations({\r\n                setSinger: 'SET_SINGER'\r\n            })\r\n        },\r\n        components: {\r\n            SingerList\r\n        }\r\n    }\r\n</script>\r\n\r\n<style lang='less' scoped>\r\n    .singer-wrapper {\r\n        position: fixed;\r\n        width: 100%;\r\n        top: 9.2rem;\r\n        bottom: 0;\r\n        .loading-more {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n        }\r\n    }\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/components/singer/singer.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"singer\",staticClass:\"singer-wrapper\"},[_c('singer-list',{ref:\"singerList\",attrs:{\"data\":_vm.singerListData},on:{\"pulldown\":_vm._gotoPrevPage,\"scrollToEnd\":_vm._loadMoreSinger,\"select\":_vm.selectSinger}}),_vm._v(\" \"),_c('router-view')],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2e8a22dc\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/singer/singer.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-2e8a22dc\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./singer.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./singer.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./singer.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-2e8a22dc\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./singer.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-2e8a22dc\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/singer/singer.vue\n// module id = null\n// module chunks = ","// 为目标DOM添加class\r\nexport function addClass(el, className) {\r\n    if (hasClass(el, className)) {\r\n        return\r\n    }\r\n    let newClass = el.className.split(' ')\r\n    newClass.push(className)\r\n    el.className = newClass.join(' ')\r\n}\r\n\r\n// 检查当前目标DOM是否有该class\r\nfunction hasClass(el, className) {\r\n    let reg = new RegExp('(^|\\\\s)' + className + '(\\\\s|$)')\r\n    return reg.test(el.className)\r\n}\r\n\r\nexport function getAttributeData(el, name, value) {\r\n    const prefix = 'data-'\r\n    name = prefix + name\r\n    if (value) {\r\n        return el.setAttribute(name, value)\r\n    } else {\r\n        return el.getAttribute(name)\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/common/js/dom.js"],"sourceRoot":""}